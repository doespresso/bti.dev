{% if matrix is not defined %}
    {% set matrix = entry.pageMatrix %}
{% endif %}

{% if matrix is defined and matrix.blocks.count>0 %}

    {% set tabs = matrix.type('sectionTabs') ? true : false %}
    {% set tabscount = 0 %}
    {% set tabs_content %}
        {% for block in matrix.type('sectionProjects','sectionExperts','sectionNav','sectionExperts') %}
            {% set intabs = block['inTabs'] is defined and block.inTabs == 1 ? true :false %}
            {% if intabs %}
                {% set be = false %}
                {% set hideDate= block['blockHideDate'] is defined and block.blockHideDate == 1 ? 1 : 0 %}
                {% set hideShort= block['blockHideShort'] is defined and block.blockHideShort == 1 ? 1 : 0 %}
                {% set bLink = block['blockLink'] is defined and block.blockLink|length ? block.blockLink %}
                {% set tmpl =  block['blockTemplate'] is defined and block.blockTemplate is not empty ? block.blockTemplate : '' %}
                {% set bRequest = block['blockRequest'] is defined and block.blockRequest == 1 ? 1 : 0 %}
                {% set bTitle = block['blockTitle'] is defined and block.blockTitle is not empty ? block.blockTitle %}
                {% set innerTitle = false %}


                {% set section_body %}
                    {#{% if block.type == "sectionDocs" %}#}
                        {#{% include "_blocks/_docs.html" %}#}
                    {#{% endif %}#}

                    {% if block.type == "sectionNav" %}
                        {% include "_blocks/_nav.html" %}
                    {% endif %}

                    {% if block.type == "sectionPublications" and cot != 'category' %}
                        {% include "_blocks/_publications.html" %}
                    {% endif %}

                    {% if block.type == "sectionProjects" %}
                        {% include "_blocks/_projects.html" %}
                    {% endif %}

                    {% if block.type == "sectionSubservices" and entry.children.total() > 0 %}
                        {% include "_blocks/_subservices.html" %}
                    {% endif %}

                    {% if block.type == "sectionExperts" %}
                        {% include "_blocks/_persons.html" %}
                    {% endif %}
                {% endset %}

                {% if not be %}
                    {% set tabscount = tabscount + 1 %}

                    {% set isService = (current.type == 'typeService') ? true : false %}
                    {% set bTheme = block['blockTheme'] is defined and block.blockTheme|length ? 'md-theme-ct' ~ block.blockTheme[0].id ~' has-theme': '' %}
                    {% set pTheme = block['blockPad'] is defined and block.blockPad|length ? block.blockPad[0] %}
                    {% if block['blockT'] is defined %}
                        {% if block.blockT == '0' %}
                            {% set bTheme = 'md-theme-' ~ headerTheme ~ ' has-theme' %}
                        {% elseif block.blockT == '1' %}
                            {% set bTheme = 'md-theme-dgrey has-theme' %}
                        {% elseif block.blockT == '2' %}
                            {% set bTheme = 'md-theme-lgrey has-theme' %}
                        {% endif %}
                    {% endif %}
                    {% set bIcon = block['blockIcon'] is defined and block.blockIcon is not empty ? block.blockIcon %}
                    {% set bContainer = block['blockContainer'] is defined and block.blockContainer == 1 ? 1 : 0 %}
                    {% set iconTheme = block['blockIconTheme'] is defined and block.blockIconTheme|length ? block.blockIconTheme[0] %}
                    {% set mono = block['blockTheme'] is defined and block.blockTheme|length ? 'multi' : 'icon--mono' %}
                    {% set pv = pTheme.paddingV is defined ? pTheme.paddingV %}
                    {% set mv = pTheme.marginV is defined ? pTheme.marginV %}

                    <md-tab id="t{{ block.id }}" md-label="{{ block.blockTitle ? block.blockTitle : 'See also'|t }}">

                        <section class="section {{ bTheme }}">
                            {% if iconTheme %}
                                <div class="media-container">
                                    <div v-in-viewport.once
                                         class="block-icon bg-icon icons--themed {{ mono }} icon-color--{{ iconTheme.styleIconColor and bTheme != '' ? iconTheme.styleIconColor : 'ht' }} scale--{{ iconTheme.styleIconSize | default('x1') }} icon-sw--{{ iconTheme.styleIconLine | default('x1') }} icon-ani--draw align--{{ iconTheme.styleIconAlign | default('left') }} valign--{{ iconTheme.styleIconAlignV | default('bottom') }}">{{ iconTheme.styleIcon ? iconTheme.styleIcon.inline }}</div>
                                </div>
                            {% endif %}

                            {% if bTitle|length and not innerTitle %}
                                {% if block.type != "sectionHtml" and block.type != "sectionHtmlCard" %}
                                    <div class="ctr section-title t-color">{{ bTitle }}</div>
                                {% endif %}
                            {% endif %}

                            {% if bContainer == 1 %}
                            <div class="ctr section-content">
                                {% endif %}

                                {{ section_body }}

                                {% if bContainer == 1 %}
                            </div>
                            {% endif %}

                            {% if bLink|length or bRequest == 1 %}
                                {% if block.type != "sectionHtml" and block.type != "sectionHtmlCard" %}
                                    <div class="ctr">
                                        <div class="grid">
                                            <div class="col-12 actions">
                                                {% for item in bLink %}
                                                    <md-button class="md-raised" href="{{ item.url }}">{{ item.title }}</md-button>
                                                {% endfor %}
                                                {% if bRequest ==1 %}
                                                    {% include 'inc/_request-button.html' %}
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                {% endif %}
                            {% endif %}
                        </section>


                    </md-tab>
                {% endif %}
            {% endif %}
        {% endfor %}
    {% endset %}

    {% for block in matrix %}
        {% set be = false %}
        {% set intabs = block['inTabs'] is defined and block.inTabs == 1 ? true : false %}
        {% set innerTitle = false %}


        {% set hideDate= block['blockHideDate'] is defined and block.blockHideDate == 1 ? 1 : 0 %}
        {% set hideShort= block['blockHideShort'] is defined and block.blockHideShort == 1 ? 1 : 0 %}
        {% set bLink = block['blockLink'] is defined and block.blockLink|length ? block.blockLink %}
        {% set tmpl =  block['blockTemplate'] is defined and block.blockTemplate is not empty ? block.blockTemplate : '' %}
        {% set bRequest = block['blockRequest'] is defined and block.blockRequest == 1 ? 1 : 0 %}

        {% set bTitle = block['blockTitle'] is defined and block.blockTitle is not empty ? block.blockTitle %}

        {% set section_body = 0 %}
        {% set section_body %}

            {% if block.type == "sectionDocs" %}
                {% include "_blocks/_docs.html" %}
            {% endif %}

            {% if block.type == "sectionNav" %}
                {% include "_blocks/_nav.html" %}
            {% endif %}

            {% if block.type == "sectionPublications" and cot != 'category' %}
                {% include "_blocks/_publications.html" %}
            {% endif %}

            {% if block.type == "sectionProjects" %}
                {% include "_blocks/_projects.html" %}
            {% endif %}

            {% if block.type == "sectionJobs" %}
                {% include "_blocks/_jobs.html" %}
            {% endif %}

            {% if block.type == "sectionQuotes" %}
                {% include "_blocks/_quotes.html" %}
            {% endif %}

            {% if block.type == "sectionInfogs" %}
                {% include "_blocks/_infogs.html" %}
            {% endif %}

            {% if block.type == "sectionExperts" %}
                {% include "_blocks/_persons.html" %}
            {% endif %}

            {% if block.type == "sectionOffices" and block.blockContent|length %}
                {% include "_blocks/_offices.html" %}
            {% endif %}

            {% if block.type == "sectionBanners" %}
                {% include "_blocks/_banners.html" %}
            {% endif %}

            {% if block.type == "sectionHtml" and (block.blockTitle or block.blockContent) %}
                {% include "_blocks/_html.html" %}
            {% endif %}

            {% if block.type == "sectionHtmlCard" and (block.blockTitle or block.blockContent) %}
                {% include "_blocks/_html-card.html" %}
            {% endif %}

            {% if block.type == "sectionImages" and block.blockContent|length %}
                {% include "_blocks/_images.html" %}
            {% endif %}

            {% if block.type == "sectionVideo" and block.blockContent|length %}
                {% include "_blocks/_video.html" %}
            {% endif %}

            {% if block.type == "sectionTabs" %}

            {% endif %}

        {% endset %}


        {#{% if not be and not (tabs and intabs and tabscount > 1) %}#}
        {% if not be and not (tabs and intabs and tabscount > 1) %}

            {#{% if section_body %}#}
                {#<hr>{{ section_body }}<hr>#}
            {#{% endif %}#}

            {#{% if block.type == "sectionDivider" %}#}
            {#{% set pv = '0' %}#}
            {#{% set mv = '0' %}#}
            {#{% endif %}#}

            {% if block.type == "sectionDivider" %}
                <hr class="line-{{ block.blockContainer }}"/>
            {% else %}

                {% set isService = (current.type == 'typeService') ? true : false %}
                {% set bTheme = block['blockTheme'] is defined and block.blockTheme|length ? 'md-theme-ct' ~ block.blockTheme[0].id ~' has-theme': '' %}

                {% if block['blockT'] is defined %}
                    {% if block.blockT == '0' %}
                        {% set bTheme = 'md-theme-' ~ headerTheme ~ ' has-theme' %}
                    {% elseif block.blockT == '1' %}
                        {% set bTheme = 'md-theme-dgrey has-theme' %}
                    {% elseif block.blockT == '2' %}
                        {% set bTheme = 'md-theme-lgrey has-theme' %}
                    {% endif %}
                {% endif %}

                {% set pTheme = block['blockPad'] is defined and block.blockPad|length ? block.blockPad[0] %}

                {% set bIcon = block['blockIcon'] is defined and block.blockIcon is not empty ? block.blockIcon %}
                {% set bContainer = block['blockContainer'] is defined and block.blockContainer == 1 ? 1 : 0 %}

                {% set iconTheme = block['blockIconTheme'] is defined and block.blockIconTheme|length ? block.blockIconTheme[0] %}
                {% set mono = block['blockTheme'] is defined and block.blockTheme|length ? 'icon--multi' : 'icon--mono-0' %}

                {% set pv = pTheme.paddingV is defined ? pTheme.paddingV %}
                {% set mv = pTheme.marginV is defined ? pTheme.marginV %}


                {% set section_start %}
                    {#<section class="section {{ currentType == 'typePublication' ? 'article-section' : 'page-section' }} {{ pv is defined and pv is not empty ? 'p-v-' ~ pv }} {{ mv is defined and mv is not empty ? 'm-v-' ~ mv }} {{ bTheme }}">#}
                    <section class="section {{ bTheme }}">

                    {% if iconTheme %}
                        <div class="media-container">
                            <div v-in-viewport.once
                                 class="block-icon bg-icon icons--themed {{ mono }} icon-color--{{ iconTheme.styleIconColor and bTheme != '' ? iconTheme.styleIconColor : 'ht' }} scale--{{ iconTheme.styleIconSize | default('x1') }} icon-sw--{{ iconTheme.styleIconLine | default('x1') }} icon-ani--draw align--{{ iconTheme.styleIconAlign | default('left') }} valign--{{ iconTheme.styleIconAlignV | default('bottom') }}">{{ iconTheme.styleIcon ? iconTheme.styleIcon.inline }}</div>
                        </div>
                    {% endif %}

                    {% if bTitle|length and not innerTitle and block.type != "sectionTabs" %}
                        {% if block.type != "sectionHtml" and block.type != "sectionHtmlCard" %}
                            <div class="ctr section-title t-color">{{ bTitle }}</div>
                        {% endif %}
                    {% endif %}

                    {% if bContainer == 1 or block.type == "sectionJobs" %}
                        <div class="ctr section-content">
                    {% endif %}
                {% endset %}

                {% set section_end %}
                    {% if bContainer == 1 or block.type == "sectionJobs" %}
                        </div>
                    {% endif %}

                    {% if bLink|length or bRequest == 1 %}
                        {% if block.type != "sectionHtml" and block.type != "sectionHtmlCard" %}
                            <div class="ctr">
                                <div class="grid">
                                    <div class="col-12 actions">
                                        {% for item in bLink %}
                                            <md-button class="md-raised" href="{{ item.url }}">{{ item.title }}</md-button>
                                        {% endfor %}
                                        {% if bRequest ==1 %}
                                            {% include 'inc/_request-button.html' %}
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        {% endif %}
                    {% endif %}
                    </section>
                {% endset %}

            {% endif %}

            {% if block.type != "sectionTabs" %}
                {{ section_start }}
                {{ section_body }}
                {{ section_end }}
            {% else %}
                <section class="tebs-section">
                    <md-tabs class="md-transparent tabs-inline" md-fixed>
                        {{ tabs_content }}
                    </md-tabs>
                </section>
            {% endif %}

        {% endif %}

    {% endfor %}
{% endif %}
