{% if matrix is not defined %}
    {% set matrix = entry.pageMatrix %}
{% endif %}

{% if matrix is defined %}
    {% for block in matrix %}

        {% set bTheme = block['blockTheme'] is defined and block.blockTheme|length ? 'md-theme-ct' ~ block.blockTheme[0].id ~' has-theme': '' %}
        {% set pTheme = block['blockPad'] is defined and block.blockPad|length ? block.blockPad[0] %}

        {% set bIcon = block['blockIcon'] is defined and block.blockIcon is not empty ? block.blockIcon %}
        {% set bTitle = block['blockTitle'] is defined and block.blockTitle is not empty ? block.blockTitle %}
        {% set bContainer = block['blockContainer'] is defined and block.blockContainer == 1 ? 1 : 0 %}
        {% set bRequest = block['blockRequest'] is defined and block.blockRequest == 1 ? 1 : 0 %}
        {% set bLink = block['blockLink'] is defined and block.blockLink|length ? block.blockLink %}
        {% set iconTheme = block['blockIconTheme'] is defined and block.blockIconTheme|length ? block.blockIconTheme[0] %}
        {% set mono = block['blockTheme'] is defined and block.blockTheme|length ? 'multi' : 'icon--mono' %}
        {% set tmpl =  block['blockTemplate'] is defined and block.blockTemplate is not empty ? block.blockTemplate : '' %}
        {#{% set tagged = entry.taglist %}#}

        {% set hideDate= block['blockHideDate'] is defined and block.blockHideDate == 1 ? 1 : 0 %}
        {% set hideShort= block['blockHideShort'] is defined and block.blockHideShort == 1 ? 1 : 0 %}



        {% if block.type == "sectionDivider" %}
            {% set pv = '0' %}
            {% set mv = '0' %}
        {% else %}
            {% set pv = pTheme.paddingV is defined ? pTheme.paddingV %}
            {% set mv = pTheme.marginV is defined ? pTheme.marginV %}
        {% endif %}

        {% if block.type == "sectionDivider" %}
            <hr class="line-{{ block.blockContainer }}"/>
        {% else %}

            <section
                    class="section {{ currentType == 'typePublication' ? 'article-section' : 'page-section' }} {{ pv is defined and pv is not empty ? 'p-v-' ~ pv }} {{ mv is defined and mv is not empty ? 'm-v-' ~ mv }} {{ bTheme }}">

                {% if iconTheme %}
                    <div class="media-container">
                        <div class="block-icon bg-icon icons--themed {{ mono }} icon-color--{{ iconTheme.styleIconColor and bTheme != '' ? iconTheme.styleIconColor : 'ht' }} scale--{{ iconTheme.styleIconSize | default('x1') }} icon-sw--{{ iconTheme.styleIconLine | default('x1') }} icon-ani--{{ iconTheme.styleIconAnimation | default('draw') }} animated align--{{ iconTheme.styleIconAlign | default('left') }} valign--{{ iconTheme.styleIconAlignV | default('bottom') }}">{{ iconTheme.styleIcon ? iconTheme.styleIcon.inline }}</div>
                    </div>
                {% endif %}

                {% if bTitle|length and not (tmpl == '_list.html' or tmpl == '_list-white.html' or tmpl == '_list-small.html' or tmpl == '_list-small-white.html') %}
                    {% if block.type != "sectionHtml" and block.type != "sectionHtmlCard" %}
                        <div class="ctr section-title t-color">{{ bTitle }}</div>
                    {% endif %}
                {% endif %}

                {% if bContainer == 1 or block.type == "sectionJobs" %}
                <div class="ctr section-content">
                    {% endif %}

                    {% if block.type == "sectionDocs" %}
                        {% include "_blocks/_docs.html" %}
                    {% endif %}

                    {% if block.type == "sectionNav" %}
                        {% include "_blocks/_nav.html" %}
                    {% endif %}

                    {% if block.type == "sectionPublications" and cot != 'category' %}
                        {% include "_blocks/_publications.html" %}
                    {% endif %}

                    {% if block.type == "sectionProjects" %}
                        {% include "_blocks/_projects.html" %}
                    {% endif %}

                    {% if block.type == "sectionJobs" %}
                        {% include "_blocks/_jobs.html" %}
                    {% endif %}

                    {% if block.type == "sectionQuotes" %}
                        {% include "_blocks/_quotes.html" %}
                    {% endif %}

                    {% if block.type == "sectionInfogs" %}
                        {% include "_blocks/_infogs.html" %}
                    {% endif %}

                    {% if block.type == "sectionSubservices" and entry.descendants().total() > 0 %}
                        {% include "_blocks/_subservices.html" %}
                    {% endif %}

                    {% if block.type == "sectionExperts" %}
                        {% include "_blocks/_persons.html" %}
                    {% endif %}

                    {% if block.type == "sectionOffices" and block.blockContent|length %}
                        {% include "_blocks/_offices.html" %}
                    {% endif %}

                    {% if block.type == "sectionBanners" %}
                        {% include "_blocks/_banners.html" %}
                    {% endif %}

                    {% if block.type == "sectionHtml" and (block.blockTitle or block.blockContent) %}
                        {% include "_blocks/_html.html" %}
                    {% endif %}

                    {% if block.type == "sectionHtmlCard" and (block.blockTitle or block.blockContent) %}
                        {% include "_blocks/_html-card.html" %}
                    {% endif %}

                    {% if block.type == "sectionImages" and block.blockContent|length %}
                        {% include "_blocks/_images.html" %}
                    {% endif %}

                    {% if block.type == "sectionVideo" and block.blockContent|length %}
                        {% include "_blocks/_video.html" %}
                    {% endif %}


                    {% if bContainer == 1 or block.type == "sectionJobs" %}
                    {#{% if bContainer == 1 and block.type!="sectionHtml" %}#}
                </div>
                {% endif %}

                {% if bLink|length or bRequest == 1 %}
                    {% if block.type != "sectionHtml" and block.type != "sectionHtmlCard" %}
                        <div class="ctr">
                            <div class="grid">
                                <div class="col-12 actions">
                                    {% for item in bLink %}
                                        <md-button class="md-raised" href="{{ item.url }}">{{ item.title }}</md-button>
                                    {% endfor %}
                                    {% if bRequest ==1 %}
                                        {% include 'inc/_request-button.html' %}
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    {% endif %}
                {% endif %}

            </section>

        {% endif %}
    {% endfor %}
{% endif %}
